---
layout:     post
title:      iOS多线程、线程安全和线程间通信
subtitle:   
date:       2017-08-09
author:     DH
header-img: img/post-bg-2015.jpg  
catalog: true
tags:
    - iOS
    - 多线程
    - 线程安全
    - 线程间通信
---


#### 多线程的概念

一个运行着的程序叫做一个进程，一个进程至少包含一个线程，线程是程序的执行流。在iOS中程序一旦启动就有一个线程一直运行，这个线程叫主线程。主线程是其他所
有线程的父线程。

系统中的所有县城共享进程的地址空间，所以能够自由的访问进程的空间变量。多线程访问的变量称之为“共享变量”。共享变量主要是“全局变量”和“静态变量”。

各个线程都有自己的栈，线程不能访问其他线程的的栈内变量。

进程是操作系统分配资源和调度的基本单位，线程是进程基本执行单位，一个进程对应多个线程。

线程又分为主线程和非主线程：

一般来说：主线程用于处理UI，所有的UI操作都要在主线程进行，耗时操作放在非主线程。

其实，CPU在一个单位时间只能处理一个线程（单CPU），但是可以通过快速的切换线程，就像同时在处理多个线程一样。

网上有一个比喻：

进程就是一列火车，线程是车厢，一列火车至少要有一节车厢，就如一个进程至少要有一个线程，车厢离开火车就无法运行，多个车厢可以提高运行效率。

多线程的目的就是提高系统的运行效率，将耗时操作都放在后台。

#### 互斥

在多线程的环境下，不同的线程可以同时操作某个资源，例如某些线程在读取某个数，而另外一些线程在写这个数，这个时候就很容易产生难以预料的结果，使得线程不安全，解决这个问题的方式就是让线程的操作互斥，主要使用互斥锁。

- **NSLock**

NSLock是基于信号量的，他只允许单个的线程获得并使用。



