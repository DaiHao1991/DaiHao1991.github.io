---
layout:     post
title:      5. Harmony 状态装饰器
subtitle:   
date:       2024-11-27
author:     DH
header-img: img/post-bg-digital-native.jpg 
catalog: true
tags:
    - 鸿蒙
    - 鸿蒙基础
    - Harmony
---
### 状态修饰器

在鸿蒙上，状态装饰器用于修饰状态变量，当状态变量改变时，根据不同的状态装饰器进行相应的响应式UI刷新

### 各状态装饰器

#### @State

.被@State修饰的变量作用域是组件内部;

.其修饰的变量生命周期和其自定义组件的生命周期相同;

.必须进行初始化

.当装饰器修饰的是基本类型、对象时，数据的变化可以被装饰器发现。当修饰数组时，数组的增删可以被观察，但是数组内某个对象的属性被修改时，不会引起刷新

#### @Prop

父组件传值给子组件，如果父组件中的值修改时，子组件的变量还是用@State修饰，并不是引起UI的刷新。这时需要对子组件中的状态变量使用@Prop修饰

子组件的修改不能同步到父组件！

```
@Entry
@Component
struct PropDemoPage{
  @State name :string= "张三";
  build() {
    Row(){
      childView({ childName:this.name} )

      Button("修改name")
        .onClick(()=>{
          this.name = "李四"
        })
    }
  }
}

@Component
struct childView{
  // 通过父组件传值
  @Prop childName:string = "";
  build() {
    Text(this.childName)
  }
}
```

子组件中被@Prop修饰的状态变量名字可以不用和父组件中被@State修饰的状态变量相同

当点击按钮修改name时，父组件中的name会变成李四，并同步到子组件展示：

![](https://camo.githubusercontent.com/7bdbbe42d064204954ead9974066be646c0bcaa2c860bc126dcaf90aa228b97d/68747470733a2f2f692d626c6f672e6373646e696d672e636e2f6469726563742f62343863336334313237316234633939383233336561303563383837323133612e706e67)

#### @Link

@Prop(子组件) + @State(父组件) 只能实现父到子的同步刷新。如果想实现父子的双向同步更新，需要使用@link(子组件) + @State(父组件)。

实现一个效果：

1. 点击“父组件传值给子组件”按钮，修改父组件中name的值，并传递到子组件，刷新子组件的UI：子组件从父组件获取的值：XX；

2. 子组件输入框中，输入的文本能够同步给父组件，刷新父组件的UI：父组件输入框输入的值：XXXXX.

需要注意，输入框中childName，必须使用引用传递，而不是值传递，引用传递指向同一个地址，修改其中的值，才能够进行同步！！

```

@Entry
@Component
struct LinkDemoPage{
  @State name :string= "张三";
  build() {
    Column(){
      childView({ childName:this.name} )

      Button("父组件传值给子组件")
        .onClick(()=>{
          this.name = "李四"
        })

      Text("父组件输入框输入的值：" + this.name);
    }
  }
}

@Component
struct childView{
  // 被Link修饰的状态变量，不能被初始化
  @Link childName:string;
  build() {
    Column() {
      Text("子组件从父组件获取的值 : " + this.childName)
      TextInput({text:$$this.childName}).backgroundColor(Color.Pink)
    }.backgroundColor(Color.Gray)
  }
}

```

在输入框输入hello harmony ，父子组件均能刷新：

![]https://i-blog.csdnimg.cn/direct/f048d67d0e8748b7859c7134ac47fd68.png)
